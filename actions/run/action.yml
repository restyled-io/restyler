name: Restyler
author: pbrisbin

inputs:
  binary:
    description: "Restyler binary to run"
    required: true
  log-level:
    description: "Set restyler LOG_LEVEL"
    default: "info"
  github-token:
    description: "GitHub token for fetching PR details"
    default: ${{ github.token }}

outputs:
  differences:
    description: ""
    value: ${{ steps.restyler.outputs.differences }}
  restyled-branch-name:
    description: ""
    value: ${{ steps.restyler.outputs.restyled-branch-name }}
  restyled-pr-title:
    description: ""
    value: ${{ steps.restyler.outputs.restyled-pr-title }}
  restyled-pr-body:
    description: ""
    value: ${{ steps.restyler.outputs.restyled-pr-body }}

runs:
  using: composite
  steps:
    - id: restyler
      shell: bash
      run: |
        $RESTYLER_BINARY --pr '${{github.repository }}#${{ github.event.pull_request.number }}'
        echo "differences=true" >"$GITHUB_OUTPUT"
      env:
        # For passing to run
        RESTYLER_BINARY: ${{ inputs.binary }}

        # For env-based options
        GITHUB_TOKEN: ${{ github.token }}
        LOG_BREAKPOINT: 200
        LOG_COLOR: always
        LOG_LEVEL: ${{ inputs.log-level }}
        RESTYLER_NO_CAP_DROP_ALL: x

        # TODO: defaulted inputs
        GIT_AUTHOR_EMAIL: commits@restyled.io
        GIT_AUTHOR_NAME: Restyled.io
        GIT_COMMITTER_EMAIL: commits@restyled.io
        GIT_COMMITTER_NAME: Restyled.io
